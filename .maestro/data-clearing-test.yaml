appId: com.fogofdog.app
---
# Test: Full Data Clearing Functionality
# Purpose: Verify all data clearing options (Last Hour, Last Day, All Time) work correctly
# Note: Button is now always enabled, even with no data points

# Set initial location
- setLocation:
    latitude: 37.78825
    longitude: -122.4324

# Launch app WITHOUT clearing state to preserve injected historical data
- launchApp:
    appId: com.fogofdog.app
- waitForAnimationToEnd

# Handle login flow if needed (optional - app might already be authenticated)
- runFlow:
    when:
      visible: 'Sign In'
    commands:
      - assertVisible:
          id: 'signInButton'
      - tapOn:
          id: 'signInButton'
      - waitForAnimationToEnd

# Handle location permission if needed
- runFlow:
    when:
      visible: 'Allow'
    commands:
      - tapOn: 'Allow While Using App'
      - waitForAnimationToEnd

# Wait for map screen to load - using multiple approaches for reliability
- waitForAnimationToEnd
- waitForAnimationToEnd
- assertVisible:
    id: 'map-screen'

# Data clear button should always be visible now (never disabled due to no data)
- assertVisible:
    id: 'data-clear-button'
- takeScreenshot: '01-initial-map-screen'

# Generate some exploration data by moving through locations
# This creates realistic data for testing the clearing functionality
- setLocation:
    latitude: 37.7883
    longitude: -122.4325
- waitForAnimationToEnd

- setLocation:
    latitude: 37.7890
    longitude: -122.4340
- waitForAnimationToEnd

- setLocation:
    latitude: 37.7895
    longitude: -122.4355
- waitForAnimationToEnd

# Take screenshot after generating data
- takeScreenshot: '02-after-location-changes'

# --- Test "Last Hour" ---
# Button should always be tappable now
- tapOn:
    id: 'data-clear-button'
- waitForAnimationToEnd

- assertVisible: 'Clear Exploration Data'
- takeScreenshot: '03-clear-dialog-visible'
- tapOn: 'Last Hour'
- waitForAnimationToEnd
- tapOn: 'Clear Data'
- waitForAnimationToEnd
- tapOn: 'OK'
- waitForAnimationToEnd

# --- Test "Last Day" ---
- tapOn:
    id: 'data-clear-button'
- waitForAnimationToEnd
- assertVisible: 'Clear Exploration Data'
- tapOn: 'Last Day'
- waitForAnimationToEnd
- tapOn: 'Clear Data'
- waitForAnimationToEnd
- tapOn: 'OK'
- waitForAnimationToEnd

# --- Test "All Time" ---
- tapOn:
    id: 'data-clear-button'
- waitForAnimationToEnd
- assertVisible: 'Clear Exploration Data'
- tapOn: 'All Time'
- waitForAnimationToEnd
- tapOn: 'Clear Data'
- waitForAnimationToEnd
- tapOn: 'OK'
- waitForAnimationToEnd

# Final verification - ensure app is still functional after clearing
- assertVisible:
    id: 'map-screen'
