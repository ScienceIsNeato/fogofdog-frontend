appId: com.fogofdog.app
---
# Test: Full Data Clearing Functionality
# Purpose: Verify all data clearing options (Last Hour, Last Day, All Time) work correctly

# Set initial location
- setLocation:
    latitude: 37.78825
    longitude: -122.4324

# Launch app WITHOUT clearing state to preserve injected historical data
- launchApp:
    appId: com.fogofdog.app
- waitForAnimationToEnd:
    timeout: 1000

# Handle login flow if needed (optional - app might already be authenticated)
- runFlow:
    when:
      visible: "Sign In"
    commands:
      - assertVisible:
          id: "signInButton"
      - tapOn:
          id: "signInButton"
      - waitForAnimationToEnd:
          timeout: 3000

# Handle location permission if needed
- runFlow:
    when:
      visible: "Allow"
    commands:
      - tapOn: "Allow While Using App"
      - waitForAnimationToEnd:
          timeout: 3000

# Wait for app to fully load and check if we're on map screen or still need to handle authentication
- waitForAnimationToEnd:
    timeout: 5000

# Wait until we can see either the map screen or we need to handle more auth steps
- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 15000

# Wait for data clear button to appear (it might be disabled initially)
- extendedWaitUntil:
    visible:
      id: "data-clear-button"
    timeout: 10000
- takeScreenshot: "01-initial-map-screen"

# Generate exploration data by moving through multiple locations with pauses
# This should create exploration points that enable the clear button
- setLocation:
    latitude: 37.7883
    longitude: -122.4325
- waitForAnimationToEnd:
    timeout: 3000

- setLocation:
    latitude: 37.7890
    longitude: -122.4340
- waitForAnimationToEnd:
    timeout: 3000

- setLocation:
    latitude: 37.7895
    longitude: -122.4355
- waitForAnimationToEnd:
    timeout: 3000

- setLocation:
    latitude: 37.7900
    longitude: -122.4370
- waitForAnimationToEnd:
    timeout: 3000

# Take a screenshot to check the button state
- takeScreenshot: "02-after-location-changes"

# Wait longer for the app to process the location changes
- waitForAnimationToEnd:
    timeout: 10000

# Debug: Check if button is visible and enabled
- assertVisible:
    id: "data-clear-button"
- takeScreenshot: "03-before-tapping-clear-button"

# --- Test "Last Hour" ---
# First verify we can see the button is actually enabled by checking if we can interact with it
- tapOn: 
    id: "data-clear-button"
- waitForAnimationToEnd:
    timeout: 2000

# If the dialog doesn't appear, try tapping again
- runFlow:
    when:
      notVisible: "Clear Exploration Data"
    commands:
      - tapOn: 
          id: "data-clear-button"
      - waitForAnimationToEnd:
          timeout: 2000

- assertVisible: "Clear Exploration Data"
- takeScreenshot: "02-clear-dialog-visible"
- tapOn: "Last Hour"
- waitForAnimationToEnd
- tapOn: "Clear Data"
- waitForAnimationToEnd
- tapOn: "OK"

# --- Test "Last Day" ---
- tapOn: 
    id: "data-clear-button"
- waitForAnimationToEnd
- assertVisible: "Clear Exploration Data"
- tapOn: "Last Day"
- waitForAnimationToEnd
- tapOn: "Clear Data"
- waitForAnimationToEnd
- tapOn: "OK"

# --- Test "All Time" ---
- tapOn: 
    id: "data-clear-button"
- waitForAnimationToEnd
- assertVisible: "Clear Exploration Data"
- tapOn: "All Time"
- waitForAnimationToEnd
- tapOn: "Clear Data"
- waitForAnimationToEnd
- tapOn: "OK"

# Final verification - ensure app is still functional after clearing
- assertVisible:
    id: "map-screen" 