appId: com.fogofdog.app
---
# Street Navigation Test: Full street-data integration flow
#
# Validates developer settings for street navigation:
#   1. Launch to map
#   2. Settings → Developer Settings → Load Sample Streets
#   3. Verify ExplorationNudge with street data
#   4. Load Real Streets from Overpass API
#   5. Test Prefer Streets / Prefer Unexplored toggles
#
# GPS anchor: Eugene South Hills (44.0462, -123.0236)
#
# Preconditions: run_integration_tests.sh pre-seeds app state (onboarding
# completed, permissions granted). No conditionals needed.

# Set GPS at Eugene, OR
- setLocation:
    latitude: 44.0462
    longitude: -123.0236

# Launch directly to map (zero UI gates)
- runFlow:
    file: shared/launch-to-map.yaml

# @checkpoint: 01-map-initial
# @description: MapScreen at Eugene, OR (44.046, -123.024). Fog covers area.
#   No street data loaded yet. No ExplorationNudge visible.
- takeScreenshot: 01-map-initial

# === PART 1: Open Settings → Developer Settings ===
- tapOn:
    id: 'settings-button'
- waitForAnimationToEnd:
    timeout: 1000
- tapOn:
    id: 'developer-settings-button'
- waitForAnimationToEnd:
    timeout: 1000

# Verify Street Navigation section
- assertVisible:
    text: 'Street Navigation'
- assertVisible:
    text: 'Prefer Streets'
- assertVisible:
    text: 'Prefer Unexplored'
- assertVisible:
    text: 'Load Sample Streets'
- assertVisible:
    text: 'Load Real Streets (Overpass)'

# @checkpoint: 02-dev-settings-initial
# @description: Developer Settings view. Street Navigation section visible
#   with toggles and data loading buttons. No streets loaded yet.
- takeScreenshot: 02-dev-settings-initial

# === PART 2: Load Sample Streets ===
- tapOn:
    id: 'load-sample-streets'
- waitForAnimationToEnd:
    timeout: 2000

# Dismiss the native Alert ("Sample Streets loaded…")
- tapOn: 'OK'
- waitForAnimationToEnd:
    timeout: 500

# Verify info display appears after load (12 segments in 3×3 grid)
- assertVisible:
    id: 'street-info-loaded'
- assertVisible:
    text: '12 segments loaded'

# @checkpoint: 03-sample-streets-loaded
# @description: Developer Settings after loading sample streets. Info shows
#   "12 segments loaded". Street data is now available for the nudge.
- takeScreenshot: 03-sample-streets-loaded

# Navigate back to map
- tapOn:
    id: 'back-button'
- waitForAnimationToEnd:
    timeout: 500
- tapOn:
    id: 'close-button'
- waitForAnimationToEnd:
    timeout: 1000

# Verify ExplorationNudge is visible with sample street data
- assertVisible:
    id: 'exploration-nudge'
- assertVisible:
    id: 'nudge-street-name'
- assertVisible:
    id: 'nudge-distance-direction'
- assertVisible:
    id: 'nudge-progress'
- assertVisible:
    text: '0 / 12 streets explored'

# @checkpoint: 04-nudge-with-sample-streets
# @description: Map with ExplorationNudge visible. Shows nearest street name,
#   distance/direction, and progress "0 / 12 streets explored". Sample street
#   grid is active.
- takeScreenshot: 04-nudge-with-sample-streets

# === PART 3: Load Real Streets from Overpass API ===
- tapOn:
    id: 'settings-button'
- waitForAnimationToEnd:
    timeout: 1000
- tapOn:
    id: 'developer-settings-button'
- waitForAnimationToEnd:
    timeout: 1000

# Tap "Load Real Streets" — calls Overpass API (network dependent)
- tapOn:
    id: 'load-real-streets'

# Wait for network response (may take several seconds)
- waitForAnimationToEnd:
    timeout: 15000

# Dismiss the native Alert ("Real Streets Loaded…")
- tapOn: 'OK'
- waitForAnimationToEnd:
    timeout: 500

# Verify streets loaded (count varies based on OSM data)
- assertVisible:
    id: 'street-info-loaded'

# @checkpoint: 05-real-streets-loaded
# @description: Developer Settings after loading real streets from Overpass API.
#   Street info shows segment count from actual OSM data for Eugene area.
- takeScreenshot: 05-real-streets-loaded

# Navigate back to map, verify nudge with real data
- tapOn:
    id: 'back-button'
- waitForAnimationToEnd:
    timeout: 500
- tapOn:
    id: 'close-button'
- waitForAnimationToEnd:
    timeout: 1000

- assertVisible:
    id: 'exploration-nudge'
- assertVisible:
    id: 'nudge-street-name'
- assertVisible:
    id: 'nudge-distance-direction'

# @checkpoint: 06-nudge-with-real-streets
# @description: Map with ExplorationNudge showing real street data from
#   Overpass API. Street name and distance reflect actual OSM streets.
- takeScreenshot: 06-nudge-with-real-streets

# === PART 4: Test toggle interactions ===
- tapOn:
    id: 'settings-button'
- waitForAnimationToEnd:
    timeout: 1000
- tapOn:
    id: 'developer-settings-button'
- waitForAnimationToEnd:
    timeout: 1000

# Toggle "Prefer Streets" ON
- tapOn:
    id: 'prefer-streets-toggle'
- waitForAnimationToEnd:
    timeout: 500

# @checkpoint: 07-prefer-streets-on
# @description: Developer Settings with "Prefer Streets" toggle ON.
#   "Prefer Unexplored" toggle should now be enabled.
- takeScreenshot: 07-prefer-streets-on

# Toggle "Prefer Unexplored" ON
- tapOn:
    id: 'prefer-unexplored-toggle'
- waitForAnimationToEnd:
    timeout: 500

# @checkpoint: 08-prefer-unexplored-on
# @description: Both "Prefer Streets" and "Prefer Unexplored" toggles ON.
#   Both toggles and street info remain visible (no crash).
- takeScreenshot: 08-prefer-unexplored-on

# Verify both toggles remain stable
- assertVisible:
    text: 'Prefer Streets'
- assertVisible:
    text: 'Prefer Unexplored'
- assertVisible:
    id: 'street-info-loaded'

# Toggle "Prefer Streets" OFF — "Prefer Unexplored" should be disabled
- tapOn:
    id: 'prefer-streets-toggle'
- waitForAnimationToEnd:
    timeout: 500

# @checkpoint: 09-prefer-streets-off
# @description: "Prefer Streets" toggled OFF. "Prefer Unexplored" should
#   become disabled automatically.
- takeScreenshot: 09-prefer-streets-off

# Navigate back to map — verify app still functional
- tapOn:
    id: 'back-button'
- waitForAnimationToEnd:
    timeout: 500
- tapOn:
    id: 'close-button'
- waitForAnimationToEnd:
    timeout: 500

- assertVisible:
    id: 'map-screen'

# @checkpoint: 10-final-map
# @description: Map after all street navigation interactions. App remains
#   functional. ExplorationNudge may or may not be visible depending on
#   toggle state.
- takeScreenshot: 10-final-map
