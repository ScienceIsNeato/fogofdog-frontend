appId: com.fogofdog.app
---
# Robust Login Flow
# Cross-platform flow that handles login and all associated permission dialogs.
# Includes retry logic for flaky conditions and comprehensive permission handling.

# Set a known location before login (for GPS simulation)
- setLocation:
    latitude: 37.78825
    longitude: -122.4324

# Handle onboarding if present
- runFlow:
    file: shared/handle-onboarding.yaml

# Wait for login screen to be ready
- extendedWaitUntil:
    visible:
      id: 'signInButton'
    timeout: 10000

# Verify login screen elements
- assertVisible:
    text: 'Sign In'

# Tap sign in button
- tapOn:
    id: 'signInButton'

# Handle location permissions (cross-platform iOS/Android)
- runFlow:
    file: shared/handle-location-permissions.yaml

# Wait for map screen to load
- extendedWaitUntil:
    visible:
      id: 'map-screen'
    timeout: 15000

# Verify we're on the map
- assertVisible:
    id: 'map-screen'

# Give location services time to initialize
- waitForAnimationToEnd:
    timeout: 2000
