appId: com.fogofdog.app
jsEngine: graaljs
---
# Ground Truth Comparison Test: Background vs Foreground GPS Tracking
# This test validates that background GPS tracking produces identical fog-clearing 
# patterns as foreground tracking by comparing screenshots of the same GPS sequence.

# Test Strategy:
# 1. Foreground Baseline: Login → inject GPS coordinates while foreground → screenshot
# 2. Background Validation: Login → background app → inject coordinates → foreground → screenshot  
# 3. Image Comparison: Verify patterns are near-identical using PSNR/SSIM

# Enhanced GPS Coordinate Pattern (Distinctive Zigzag)
# Point 1: Login location (37.78825, -122.4324)
# Point 2: 1000m South (37.779266, -122.4324)
# Point 3: 2000m East (37.779266, -122.409572) - Zigzag start
# Point 4: NE zigzag (37.785266, -122.415572)
# Point 5: SE zigzag (37.779266, -122.421572)
# Point 6: NE zigzag (37.785266, -122.427572)
# Point 7: Final position (37.792742, -122.409572)

# =============================================================================
# SEQUENCE 1: FOREGROUND BASELINE (Ground Truth)
# =============================================================================

# 1.1 Setup - Fresh app launch and login
- setLocation:
    latitude: 37.78825
    longitude: -122.4324
- launchApp:
    appId: com.fogofdog.app
    clearState: true
- runFlow:
    file: robust-login.yaml
- assertVisible:
    text: "You are here"

# 1.2 Inject GPS sequence while app is in FOREGROUND
- setLocation:
    latitude: 37.779266
    longitude: -122.4324
- waitForAnimationToEnd:
    timeout: 800
- tapOn:
    id: "location-button"
- waitForAnimationToEnd:
    timeout: 500

- setLocation:
    latitude: 37.779266
    longitude: -122.409572
- waitForAnimationToEnd:
    timeout: 800
- tapOn:
    id: "location-button"
- waitForAnimationToEnd:
    timeout: 500

- setLocation:
    latitude: 37.785266
    longitude: -122.415572
- waitForAnimationToEnd:
    timeout: 800
- tapOn:
    id: "location-button"
- waitForAnimationToEnd:
    timeout: 500

- setLocation:
    latitude: 37.779266
    longitude: -122.421572
- waitForAnimationToEnd:
    timeout: 800
- tapOn:
    id: "location-button"
- waitForAnimationToEnd:
    timeout: 500

- setLocation:
    latitude: 37.785266
    longitude: -122.427572
- waitForAnimationToEnd:
    timeout: 800
- tapOn:
    id: "location-button"
- waitForAnimationToEnd:
    timeout: 500

- setLocation:
    latitude: 37.792742
    longitude: -122.409572
- waitForAnimationToEnd:
    timeout: 800
- tapOn:
    id: "location-button"
- waitForAnimationToEnd:
    timeout: 500

# 1.3 Zoom out to show complete pattern (deterministic zoom level)
- tapOn:
    point: 450,300  # Center of screen
- waitForAnimationToEnd:
    timeout: 500
# Zoom out to show full pattern
- tapOn:
    point: 400,250
- tapOn:
    point: 500,350
- waitForAnimationToEnd:
    timeout: 1000
- tapOn:
    point: 400,250
- tapOn:
    point: 500,350
- waitForAnimationToEnd:
    timeout: 1000

# 1.4 Take baseline screenshot
- takeScreenshot: foreground_baseline.png
- waitForAnimationToEnd:
    timeout: 500

# 1.5 Logout and reset app state
- pressKey: Home
- waitForAnimationToEnd:
    timeout: 1000