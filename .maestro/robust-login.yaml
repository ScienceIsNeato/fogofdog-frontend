appId: com.fogofdog.app
---
# Robust Login Flow - Handles various app states and permission dialogs
# This flow can be used reliably across different test scenarios

# 1. Ensure we're on a login-capable screen
- runFlow:
    when:
      visible: "Sign In"
    commands:
      - tapOn: "Sign In"

# 2. Handle the main sign-in button (always try this)
- runFlow:
    when:
      visible:
        id: "signInButton"
    commands:
      - tapOn:
          id: "signInButton"

# 3. Handle location permission dialog with multiple variations
- runFlow:
    when:
      visible: "Allow While Using App"
    commands:
      - tapOn: "Allow While Using App"

- runFlow:
    when:
      visible: "Allow"
    commands:
      - tapOn: "Allow"

- runFlow:
    when:
      visible: "OK"
    commands:
      - tapOn: "OK"

# 4. Wait for map to load with generous timeout
- waitForAnimationToEnd:
    timeout: 5000

# 5. Verify we reached the map screen
- assertVisible:
    id: "map-screen"