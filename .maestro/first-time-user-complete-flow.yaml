appId: com.fogofdog.app
---
# First-Time User Complete Flow Test
#
# Tests the complete journey from fresh install through onboarding to
# functional map interaction:
#   1. Launch with NO onboarding completion flag → overlay appears
#   2. Navigate all 6 onboarding steps via testID buttons
#   3. Verify map loads after onboarding completes
#   4. GPS movement works, fog clears
#   5. Settings accessible, app fully functional
#
# GPS anchor: San Francisco (37.7749, -122.4194)
#
# Preconditions: run_integration_tests.sh calls prepare_android_fresh_state()
# WITHOUT seeding @fogofdog_onboarding_completed — onboarding WILL appear.
# Permissions are still pre-granted (pm grant / permissions:all:allow).

# Set GPS at San Francisco
- setLocation:
    latitude: 37.7749
    longitude: -122.4194

# Launch app — onboarding overlay will appear
- runFlow:
    file: shared/launch-to-onboarding.yaml

# Verify onboarding is visible
- assertVisible:
    id: 'onboarding-overlay'

# @checkpoint: 01-onboarding-welcome
# @description: Onboarding overlay visible at step 1 (Welcome). Map is
#   rendering underneath but hidden by overlay. Continue button present.
- takeScreenshot: 01-onboarding-welcome

# === PHASE 1: NAVIGATE THROUGH ALL 6 ONBOARDING STEPS ===

# Step 1 → 2: Tap Continue
- tapOn:
    id: 'onboarding-continue-button'
- waitForAnimationToEnd:
    timeout: 500

# @checkpoint: 02-onboarding-step-2
# @description: Onboarding step 2. Content describes fog-of-war mechanic.
- takeScreenshot: 02-onboarding-step-2

# Step 2 → 3
- tapOn:
    id: 'onboarding-continue-button'
- waitForAnimationToEnd:
    timeout: 500

# Step 3 → 4
- tapOn:
    id: 'onboarding-continue-button'
- waitForAnimationToEnd:
    timeout: 500

# Step 4 → 5
- tapOn:
    id: 'onboarding-continue-button'
- waitForAnimationToEnd:
    timeout: 500

# @checkpoint: 03-onboarding-step-5
# @description: Onboarding step 5. One more Continue before the final step.
- takeScreenshot: 03-onboarding-step-5

# Step 5 → 6 (final)
- tapOn:
    id: 'onboarding-continue-button'
- waitForAnimationToEnd:
    timeout: 500

# @checkpoint: 04-onboarding-final-step
# @description: Onboarding step 6 (final). "Get Started!" button visible
#   instead of Continue. This is the last step before map access.
- takeScreenshot: 04-onboarding-final-step

# Step 6: Tap "Get Started!" to complete onboarding
- tapOn:
    id: 'get-started-button'
- waitForAnimationToEnd:
    timeout: 2000

# === PHASE 2: MAP LOADS AFTER ONBOARDING ===

# Wait for map to be fully interactive (overlay dismissed)
- extendedWaitUntil:
    visible:
      id: 'map-screen'
    timeout: 15000

# Verify HUD elements are interactive
- extendedWaitUntil:
    visible:
      id: 'location-button'
    timeout: 10000
- assertVisible:
    id: 'settings-button'

# @checkpoint: 05-map-after-onboarding
# @description: MapScreen visible after completing onboarding. HUD buttons
#   (location, settings) present. Fog covers the entire map area.
- takeScreenshot: 05-map-after-onboarding

# === PHASE 3: GPS MOVEMENT & FOG CLEARING ===

# Move to generate exploration data
- runFlow:
    file: shared/move-and-settle.yaml
    env:
      MOVE_LAT: '37.7759'
      MOVE_LON: '-122.4194'

# @checkpoint: 06-after-first-move
# @description: Map after GPS movement north. Fog partially cleared along
#   the path from initial position.
- takeScreenshot: 06-after-first-move

# Move again (east) to create L-shaped exploration
- runFlow:
    file: shared/move-and-settle.yaml
    env:
      MOVE_LAT: '37.7759'
      MOVE_LON: '-122.4174'

# @checkpoint: 07-after-second-move
# @description: Map after second GPS movement east. L-shaped exploration
#   pattern visible in the fog.
- takeScreenshot: 07-after-second-move

# === PHASE 4: VERIFY APP FUNCTIONALITY ===

# Open settings to verify full functionality post-onboarding
- tapOn:
    id: 'settings-button'
- waitForAnimationToEnd:
    timeout: 1000

# Verify settings menu loaded with all sections
- assertVisible:
    text: 'Map Style'
- assertVisible:
    text: 'Data Management'

# @checkpoint: 08-settings-functional
# @description: Settings menu open after first-time user flow. All options
#   visible. App is fully functional post-onboarding.
- takeScreenshot: 08-settings-functional

# Close settings
- tapOn:
    id: 'close-button'
- waitForAnimationToEnd:
    timeout: 500

# Final map state
- assertVisible:
    id: 'map-screen'

# @checkpoint: 09-final-state
# @description: Final state after complete first-time user journey: onboarding
#   completed, GPS exploration generated fog clearings, settings accessible.
#   App is fully functional.
- takeScreenshot: 09-final-state
