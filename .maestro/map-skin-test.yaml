appId: com.fogofdog.app
---
# Map Skin Test: Skin selection workflow
#
# Validates the full skin selection lifecycle:
#   1. Launch to map
#   2. Open Settings → Map Style → select Cartoon skin
#   3. Return to map and continue exploring
#   4. Reopen settings → verify Cartoon persists
#
# Preconditions: run_integration_tests.sh pre-seeds app state (onboarding
# completed, permissions granted). No conditionals needed.

# Set initial GPS
- setLocation:
    latitude: 37.78825
    longitude: -122.4324

# Launch directly to map (zero UI gates)
- runFlow:
    file: shared/launch-to-map.yaml

# @checkpoint: 01-map-loaded
# @description: MapScreen visible with fog overlay. Location marker centered
#   at initial GPS (37.788, -122.432). HUD buttons visible.
- takeScreenshot: 01-map-loaded

# Explore a bit before opening settings
- runFlow:
    file: shared/move-and-settle.yaml
    env:
      MOVE_LAT: '37.78925'
      MOVE_LON: '-122.4324'

- runFlow:
    file: shared/move-and-settle.yaml
    env:
      MOVE_LAT: '37.79025'
      MOVE_LON: '-122.4314'

# Open settings
- tapOn:
    id: 'settings-button'
- extendedWaitUntil:
    visible:
      id: 'map-style-button'
    timeout: 3000

# Navigate to Map Style
- tapOn:
    id: 'map-style-button'
- extendedWaitUntil:
    visible:
      text: 'Map Style'
    timeout: 3000

# Verify skin selection screen
- assertVisible:
    text: 'Map Style'
- assertVisible:
    text: 'Standard'
- assertVisible:
    text: 'Cartoon'

# @checkpoint: 02-skin-selection-screen
# @description: Map Style settings view showing available skins (Standard,
#   Cartoon). Standard is the default / active skin.
- takeScreenshot: 02-skin-selection-screen

# Select Cartoon skin
- tapOn:
    id: 'skin-option-cartoon'
- waitForAnimationToEnd:
    timeout: 1000

# @checkpoint: 03-cartoon-selected
# @description: Cartoon skin selected. The option should show a selection
#   indicator (checkmark or highlight).
- takeScreenshot: 03-cartoon-selected

# Navigate back to map
- tapOn:
    id: 'back-button'
- extendedWaitUntil:
    visible:
      id: 'close-button'
    timeout: 3000
- tapOn:
    id: 'close-button'
- extendedWaitUntil:
    visible:
      id: 'map-screen'
    timeout: 3000

# Verify map is still visible
- assertVisible:
    id: 'map-screen'

# Continue exploring with cartoon skin active
- runFlow:
    file: shared/move-and-settle.yaml
    env:
      MOVE_LAT: '37.79125'
      MOVE_LON: '-122.4304'

- runFlow:
    file: shared/move-and-settle.yaml
    env:
      MOVE_LAT: '37.79225'
      MOVE_LON: '-122.4294'

# @checkpoint: 04-map-with-cartoon-skin
# @description: Map after two additional movements with Cartoon skin active.
#   Four fog holes visible. Cartoon skin styling should be applied to the map.
- takeScreenshot: 04-map-with-cartoon-skin

# Reopen settings to verify skin persists
- tapOn:
    id: 'settings-button'
- extendedWaitUntil:
    visible:
      id: 'map-style-button'
    timeout: 3000
- tapOn:
    id: 'map-style-button'
- extendedWaitUntil:
    visible:
      id: 'skin-option-cartoon'
    timeout: 3000

# Verify cartoon skin is still selected
- assertVisible:
    id: 'skin-option-cartoon'

# @checkpoint: 05-skin-persisted
# @description: Map Style settings reopened. Cartoon skin should still be
#   selected, confirming persistence across settings open/close cycles.
- takeScreenshot: 05-skin-persisted

# Close settings
- tapOn:
    id: 'back-button'
- extendedWaitUntil:
    visible:
      id: 'close-button'
    timeout: 3000
- tapOn:
    id: 'close-button'
- extendedWaitUntil:
    visible:
      id: 'map-screen'
    timeout: 3000

# Final map assertion
- assertVisible:
    id: 'map-screen'
