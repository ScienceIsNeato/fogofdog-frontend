#!/bin/bash
# Auto-generated by slop-mop setup — runs sm from the local submodule.
# Do NOT install slop-mop via pip. Each project gets its own copy.
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
SLOP_MOP_DIR="$PROJECT_ROOT/slop-mop"

if [ ! -d "$SLOP_MOP_DIR/slopmop" ]; then
    echo "Error: slop-mop submodule not found at $SLOP_MOP_DIR"
    echo "   Run: git submodule update --init"
    exit 1
fi

# Find Python executable (prefer project venv, fall back to system Python)
PYTHON=""
if [ -f "$PROJECT_ROOT/venv/bin/python" ]; then
    PYTHON="$PROJECT_ROOT/venv/bin/python"
elif [ -f "$PROJECT_ROOT/.venv/bin/python" ]; then
    PYTHON="$PROJECT_ROOT/.venv/bin/python"
elif command -v python3 >/dev/null 2>&1; then
    PYTHON="python3"
elif command -v python >/dev/null 2>&1; then
    PYTHON="python"
else
    echo "❌ Error: No Python found. Install Python 3 or create a venv."
    exit 1
fi

# Run the module directly from the submodule
export PYTHONPATH="$SLOP_MOP_DIR:${PYTHONPATH:-}"
exec "$PYTHON" -m slopmop.sm "$@"
