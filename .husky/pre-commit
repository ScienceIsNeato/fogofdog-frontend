#!/usr/bin/env sh
# Load environment variables for git hooks
# Try to source environment from common locations
if [ -f .envrc ]; then
  # Use direnv if available
  if command -v direnv >/dev/null 2>&1; then
    eval "$(direnv export sh)"
  else
    # Source .envrc manually if direnv not available
    set -a
    . ./.envrc
    set +a
  fi
elif [ -f .env ]; then
  # Load from .env file if it exists
  set -a
  . ./.env
  set +a
fi

# slop-mop quality gate
# Uses the ./sm wrapper (gradlew-style) that runs slop-mop directly from the submodule.
# No global pip install needed — the submodule is self-contained.
#
# If ./sm is missing, run setup first:
#   ./slop-mop/scripts/setup.sh
#
# The "commit" profile includes all configured gates. Disabled gates
# (via .sb_config.json or ./sm config --disable) are automatically skipped.
# Commit is blocked if any enabled gate fails.

if [ ! -f "./sm" ]; then
  echo "❌ ./sm wrapper not found. Run: ./slop-mop/scripts/setup.sh"
  exit 1
fi

./sm validate commit
./sm validate --quality-gates javascript:types,general:deploy-tests
