#!/usr/bin/env bash
# Load environment variables for git hooks
# Activate venv if it exists
if [ -f .venv/bin/activate ]; then
  source .venv/bin/activate
fi

# Load environment from common locations
if [ -f .envrc ]; then
  set -a
  source .envrc
  set +a
elif [ -f .env ]; then
  set -a
  source .env
  set +a
fi

# slop-mop quality gate (replaces ship_it.py)
# Installs slop-mop if not already on PATH, then runs the commit profile.
# Commit is blocked if any gate fails.
if ! command -v sm >/dev/null 2>&1; then
  pip3 install -e ./slop-mop --break-system-packages --quiet 2>/dev/null || \
  pip install -e ./slop-mop --break-system-packages --quiet 2>/dev/null
fi

# JavaScript/TypeScript project - use JavaScript gates instead of Python gates
sm validate --quality-gates python:lint-format,quality:complexity,security:local
