#!/usr/bin/env sh
# Load environment variables for git hooks
# Try to source environment from common locations
if [ -f .envrc ]; then
  # Use direnv if available
  if command -v direnv >/dev/null 2>&1; then
    eval "$(direnv export sh)"
  else
    # Source .envrc manually if direnv not available
    set -a
    . ./.envrc
    set +a
  fi
elif [ -f .env ]; then
  # Load from .env file if it exists
  set -a
  . ./.env
  set +a
fi

# slop-mop quality gate
# Runs the commit profile which includes:
# - JavaScript: lint-format, tests, types, coverage, bogus-tests
# - Quality: loc-lock, source-duplication, string-duplication, dead-code
# Commit is blocked if any gate fails.
# Uses the "commit" profile which includes JS lint/test/coverage gates.
# The "javascript" alias also includes javascript:types which requires
# native module type declarations (react-native-maps, expo-file-system)
# that aren't resolvable without a native build â€” use "commit" instead.
# Disabled gates (via .sb_config.json or sm config --disable) are automatically skipped.
if ! command -v sm >/dev/null 2>&1; then
  pip3 install -e ./slop-mop --break-system-packages --quiet 2>/dev/null || \
  pip install -e ./slop-mop --break-system-packages --quiet 2>/dev/null
fi

sm validate commit
